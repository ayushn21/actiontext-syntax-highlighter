(()=>{"use strict";var t={990:(t,e,n)=>{n.d(e,{Z:()=>r});var o=n(268),i=n.n(o)()(!0);i.push([t.id,"trix-editor pre[contenteditable] {\n  -webkit-user-select: text;\n  user-select: text;\n}\n\ntrix-editor pre[contenteditable]::selection {\n  background: highlight;\n  color: highlightText;\n}\n\ntrix-editor select[name='language'] {\n  margin: 0.4em 0;\n  font-size: 0.8em;\n  padding: 0.4em 0;\n}\n\nhighlighted-code-block > pre {\n  text-align: left;\n  outline: none;\n}\n\nhighlighted-code-block  > select {\n  display: inline-block;\n  float: right;\n}\n\nfigure[data-trix-mutable][data-trix-highlighted-code-block] pre {\n  box-shadow: 0 0 0 1px highlight;\n}\n\ntrix-toolbar[data-highlights-code-blocks][data-disable-styling-interaction] .trix-button-group--text-tools > button,\ntrix-toolbar[data-highlights-code-blocks][data-disable-styling-interaction] .trix-button-group--block-tools > button,\ntrix-toolbar[data-highlights-code-blocks][data-disable-styling-interaction] .trix-button-group--file-tools > button {\n  pointer-events: none;\n}\n","",{version:3,sources:["webpack://app/frontend/action_text_syntax_highlighter/css/highlighted_code_block.css"],names:[],mappings:"AAAA;EACE,yBAAyB;EACzB,iBAAiB;AACnB;;AAEA;EACE,qBAAqB;EACrB,oBAAoB;AACtB;;AAEA;EACE,eAAe;EACf,gBAAgB;EAChB,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;EAChB,aAAa;AACf;;AAEA;EACE,qBAAqB;EACrB,YAAY;AACd;;AAEA;EACE,+BAA+B;AACjC;;AAEA;;;EAGE,oBAAoB;AACtB",sourcesContent:["trix-editor pre[contenteditable] {\n  -webkit-user-select: text;\n  user-select: text;\n}\n\ntrix-editor pre[contenteditable]::selection {\n  background: highlight;\n  color: highlightText;\n}\n\ntrix-editor select[name='language'] {\n  margin: 0.4em 0;\n  font-size: 0.8em;\n  padding: 0.4em 0;\n}\n\nhighlighted-code-block > pre {\n  text-align: left;\n  outline: none;\n}\n\nhighlighted-code-block  > select {\n  display: inline-block;\n  float: right;\n}\n\nfigure[data-trix-mutable][data-trix-highlighted-code-block] pre {\n  box-shadow: 0 0 0 1px highlight;\n}\n\ntrix-toolbar[data-highlights-code-blocks][data-disable-styling-interaction] .trix-button-group--text-tools > button,\ntrix-toolbar[data-highlights-code-blocks][data-disable-styling-interaction] .trix-button-group--block-tools > button,\ntrix-toolbar[data-highlights-code-blocks][data-disable-styling-interaction] .trix-button-group--file-tools > button {\n  pointer-events: none;\n}\n"],sourceRoot:""}]);const r=i},268:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n,o,i,r=t[1]||"",a=t[3];if(!a)return r;if(e&&"function"==typeof btoa){var s=(n=a,o=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(i," */")),l=a.sources.map((function(t){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(t," */")}));return[r].concat(l).concat([s]).join("\n")}return[r].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,o){"string"==typeof t&&(t=[[null,t,""]]);var i={};if(o)for(var r=0;r<this.length;r++){var a=this[r][0];null!=a&&(i[a]=!0)}for(var s=0;s<t.length;s++){var l=[].concat(t[s]);o&&i[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),e.push(l))}},e}},379:(t,e,n)=>{var o,i=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),r=[];function a(t){for(var e=-1,n=0;n<r.length;n++)if(r[n].identifier===t){e=n;break}return e}function s(t,e){for(var n={},o=[],i=0;i<t.length;i++){var s=t[i],l=e.base?s[0]+e.base:s[0],c=n[l]||0,d="".concat(l," ").concat(c);n[l]=c+1;var h=a(d),u={css:s[1],media:s[2],sourceMap:s[3]};-1!==h?(r[h].references++,r[h].updater(u)):r.push({identifier:d,updater:p(u,e),references:1}),o.push(d)}return o}function l(t){var e=document.createElement("style"),o=t.attributes||{};if(void 0===o.nonce){var r=n.nc;r&&(o.nonce=r)}if(Object.keys(o).forEach((function(t){e.setAttribute(t,o[t])})),"function"==typeof t.insert)t.insert(e);else{var a=i(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var c,d=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function h(t,e,n,o){var i=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(t.styleSheet)t.styleSheet.cssText=d(e,i);else{var r=document.createTextNode(i),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function u(t,e,n){var o=n.css,i=n.media,r=n.sourceMap;if(i?t.setAttribute("media",i):t.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleSheet)t.styleSheet.cssText=o;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(o))}}var g=null,b=0;function p(t,e){var n,o,i;if(e.singleton){var r=b++;n=g||(g=l(e)),o=h.bind(null,n,r,!1),i=h.bind(null,n,r,!0)}else n=l(e),o=u.bind(null,n,e),i=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return o(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;o(t=e)}else i()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o));var n=s(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var o=0;o<n.length;o++){var i=a(n[o]);r[i].references--}for(var l=s(t,e),c=0;c<n.length;c++){var d=a(n[c]);0===r[d].references&&(r[d].updater(),r.splice(d,1))}n=l}}}}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={id:o,exports:{}};return t[o](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{class t extends HTMLElement{connectedCallback(){var t;(null==(t=this.closest("trix-editor"))?void 0:t.editor)&&this.setup()}setup(){this.editor=this.closest("trix-editor").editor,this.closest("figure").dataset.trixHighlightedCodeBlock=!0,this.trixId=parseInt(this.parentElement.dataset.trixId),this.attachment=this.editor.getDocument().getAttachmentById(this.trixId),this.attachment.type="HighlightedCodeBlock",this.configureEventListeners()}save(){let t=this.attachment.getAttributes().sgid;this.editor.syntaxHighlighter.saveCodeBlock(this.toJSON(),t),this.render()}render(){this.attachment.setAttributes({content:this.outerHTML})}languageChanged(t){this.selectLanguage(t.target.value),this.save()}selectLanguage(t){this.languageSelector.querySelector("option[selected]").removeAttribute("selected"),this.languageSelector.querySelector(`option[value='${t}']`).setAttribute("selected","")}configureEventListeners(){this.codeBlock.addEventListener("blur",this.save.bind(this)),this.languageSelector.addEventListener("change",this.languageChanged.bind(this))}toJSON(){return JSON.stringify({highlighted_code_block:{content:this.codeBlock.innerHTML,language:this.languageSelector.value}})}get codeBlock(){return this.querySelector("pre")}get languageSelector(){return this.querySelector("select")}}function e(){return{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":document.head.querySelector("meta[name='csrf-token']").content}}class o{constructor(t){this.element=t,this.editor=t.editor,this.setup()}addCodeBlock(t){fetch(c.basePath,{method:"POST",headers:e()}).then((t=>t.json())).then((t=>this.insertCodeBlock(t)))}saveCodeBlock(t,n){fetch(`${c.basePath}/${n}`,{method:"PATCH",headers:e(),body:t})}insertCodeBlock(t){let e=new Trix.Attachment(t);this.editor.insertAttachment(e),this.editor.composition.editAttachment(e)}setup(){var t;this.editorToolbar.setAttribute("data-highlights-code-blocks",""),this.editor.syntaxHighlighter=this,this.interceptToolbarCodeButton(),this.watchCursor(),null==(t=this.element.querySelector("highlighted-code-block"))||t.setup()}interceptToolbarCodeButton(){this.editorToolbarCodeButton.addEventListener("mousedown",(t=>{this.addCodeBlock(),t.preventDefault(),t.stopImmediatePropagation()}))}watchCursor(){this.element.addEventListener("trix-selection-change",(t=>{this.updateToolbarState(this.editor.getPosition())}))}updateToolbarState(t){var e;"HighlightedCodeBlock"==(null==(e=this.editor.getDocument().getPieceAtPosition(t).attachment)?void 0:e.type)?(this.editorToolbarCodeButton.classList.add("trix-active"),this.editorToolbar.dataset.disableStylingInteraction=!0):(this.editorToolbarCodeButton.classList.remove("trix-active"),this.editorToolbar.removeAttribute("data-disable-styling-interaction"))}get editorToolbar(){return this.element.toolbarElement}get editorToolbarCodeButton(){return this.editorToolbar.querySelector("[data-trix-attribute='code']")}}var i=n(379),r=n.n(i),a=n(990);r()(a.Z,{insert:"head",singleton:!1}),a.Z.locals;var s,l=Object.defineProperty;class c{static start(){customElements.define("highlighted-code-block",t),document.addEventListener("trix-initialize",(t=>{t.target.dataset.highlightsCodeBlocks&&new o(t.target)}))}}((t,e,n)=>{e in t?l(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(c,"symbol"!=typeof(s="basePath")?s+"":s,"/rails/action_text/highlighted_code_blocks"),c.start()})()})();
//# sourceMappingURL=index.js.map