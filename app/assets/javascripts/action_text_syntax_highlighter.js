(()=>{"use strict";var t={97:(t,e,n)=>{var i=n(268);n.n(i)()(!0).push([t.id,"trix-editor pre[contenteditable] {\n  -webkit-user-select: text;\n  user-select: text;\n}\n\ntrix-editor pre[contenteditable]::selection {\n  background: highlight;\n  color: highlightText;\n}\n\ntrix-editor select[name='language'] {\n  margin: 0.4em 0;\n  font-size: 0.8em;\n  padding: 0.4em 0;\n}\n\nhighlighted-code-block > pre {\n  text-align: left;\n  outline: none;\n}\n\nhighlighted-code-block  > select {\n  display: inline-block;\n  float: right;\n}\n\nfigure[data-trix-mutable][data-trix-highlighted-code-block] pre {\n  box-shadow: 0 0 0 1px highlight;\n}\n\ntrix-toolbar[data-highlights-code-blocks] [data-trix-attribute='code'].trix-active {\n  pointer-events: none;\n}","",{version:3,sources:["webpack://app/frontend/action_text_syntax_highlighter/css/highlighted_code_block.css"],names:[],mappings:"AAAA;EACE,yBAAyB;EACzB,iBAAiB;AACnB;;AAEA;EACE,qBAAqB;EACrB,oBAAoB;AACtB;;AAEA;EACE,eAAe;EACf,gBAAgB;EAChB,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;EAChB,aAAa;AACf;;AAEA;EACE,qBAAqB;EACrB,YAAY;AACd;;AAEA;EACE,+BAA+B;AACjC;;AAEA;EACE,oBAAoB;AACtB",sourcesContent:["trix-editor pre[contenteditable] {\n  -webkit-user-select: text;\n  user-select: text;\n}\n\ntrix-editor pre[contenteditable]::selection {\n  background: highlight;\n  color: highlightText;\n}\n\ntrix-editor select[name='language'] {\n  margin: 0.4em 0;\n  font-size: 0.8em;\n  padding: 0.4em 0;\n}\n\nhighlighted-code-block > pre {\n  text-align: left;\n  outline: none;\n}\n\nhighlighted-code-block  > select {\n  display: inline-block;\n  float: right;\n}\n\nfigure[data-trix-mutable][data-trix-highlighted-code-block] pre {\n  box-shadow: 0 0 0 1px highlight;\n}\n\ntrix-toolbar[data-highlights-code-blocks] [data-trix-attribute='code'].trix-active {\n  pointer-events: none;\n}"],sourceRoot:""}])},268:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n,i,o,r=t[1]||"",a=t[3];if(!a)return r;if(e&&"function"==typeof btoa){var s=(n=a,i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),"/*# ".concat(o," */")),c=a.sources.map((function(t){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(t," */")}));return[r].concat(c).concat([s]).join("\n")}return[r].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var o={};if(i)for(var r=0;r<this.length;r++){var a=this[r][0];null!=a&&(o[a]=!0)}for(var s=0;s<t.length;s++){var c=[].concat(t[s]);i&&o[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),e.push(c))}},e}}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={id:i,exports:{}};return t[i](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{class t extends HTMLElement{connectedCallback(){var t;(null==(t=this.closest("trix-editor"))?void 0:t.editor)&&this.setup()}setup(){this.editor=this.closest("trix-editor").editor,this.closest("figure").dataset.trixHighlightedCodeBlock=!0,this.trixId=parseInt(this.parentElement.dataset.trixId),this.attachment=this.editor.getDocument().getAttachmentById(this.trixId),this.attachment.type="HighlightedCodeBlock",this.configureEventListeners()}save(){let t=this.attachment.getAttributes().sgid;this.editor.syntaxHighlighter.saveCodeBlock(this.toJSON(),t),this.render()}render(){this.attachment.setAttributes({content:this.outerHTML})}languageChanged(t){this.selectLanguage(t.target.value),this.save()}selectLanguage(t){this.languageSelector.querySelector("option[selected]").removeAttribute("selected"),this.languageSelector.querySelector(`option[value='${t}']`).setAttribute("selected","")}configureEventListeners(){this.codeBlock.addEventListener("blur",this.save.bind(this)),this.languageSelector.addEventListener("change",this.languageChanged.bind(this))}toJSON(){return JSON.stringify({highlighted_code_block:{content:this.codeBlock.innerHTML,language:this.languageSelector.value}})}get codeBlock(){return this.querySelector("pre")}get languageSelector(){return this.querySelector("select")}}function e(){return{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":document.head.querySelector("meta[name='csrf-token']").content}}class i{constructor(t){this.element=t,this.editor=t.editor,this.setup()}addCodeBlock(t){fetch(a.basePath,{method:"POST",headers:e()}).then((t=>t.json())).then((t=>this.insertCodeBlock(t)))}saveCodeBlock(t,n){fetch(`${a.basePath}/${n}`,{method:"PATCH",headers:e(),body:t})}insertCodeBlock(t){let e=new Trix.Attachment(t);this.editor.insertAttachment(e),this.editor.composition.editAttachment(e)}setup(){this.editorToolbar.setAttribute("data-highlights-code-blocks",""),this.editor.syntaxHighlighter=this,this.interceptToolbarCodeButton(),this.watchCursor(),this.element.querySelector("highlighted-code-block").setup()}interceptToolbarCodeButton(){this.editorToolbarCodeButton.addEventListener("mousedown",(t=>{this.addCodeBlock(),t.preventDefault(),t.stopImmediatePropagation()}))}watchCursor(){this.element.addEventListener("trix-selection-change",(t=>{this.updateToolbarCodeButtonState(this.editor.getPosition())}))}updateToolbarCodeButtonState(t){var e;"HighlightedCodeBlock"==(null==(e=this.editor.getDocument().getPieceAtPosition(t).attachment)?void 0:e.type)?this.editorToolbarCodeButton.classList.add("trix-active"):this.editorToolbarCodeButton.classList.remove("trix-active")}get editorToolbar(){return this.element.toolbarElement}get editorToolbarCodeButton(){return this.editorToolbar.querySelector("[data-trix-attribute='code']")}}var o,r=Object.defineProperty;class a{static start(){customElements.define("highlighted-code-block",t),document.addEventListener("trix-initialize",(t=>{t.target.dataset.highlightsCodeBlocks&&new i(t.target)}))}}((t,e,n)=>{e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(a,"symbol"!=typeof(o="basePath")?o+"":o,"/action_text/highlighted_code_blocks"),n(97)})()})();
//# sourceMappingURL=action_text_syntax_highlighter.js.map